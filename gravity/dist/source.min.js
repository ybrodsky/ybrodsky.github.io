var Vector=function(a,b){this.x=a,this.y=b},Gravity=function(){this.constant=6.67384*Math.pow(10,-11)};Gravity.prototype.calculateAcceleration=function(a,b){return this.constant*a/Math.pow(b,2)};var Celestial=function(a,b,c,d,e){this.x=a,this.y=b,this.radius=c,this.mass=1e11*Math.pow(c,2),this.fill=d||"#"+(16777215*Math.random()<<0).toString(16),this.speed={x:0,y:0},this.acceleration=e?{x:e.x/4,y:e.y/4}:{x:0,y:0}};Celestial.prototype.distanceTo=function(a,b){return Math.sqrt(Math.pow(a-this.x,2)+Math.pow(b-this.y,2))},Celestial.prototype.directionTo=function(a,b){var c=this.x-a<0?1:-1,d=this.y-b<0?1:-1;return{x:c,y:d}},Celestial.prototype.applyForce=function(a){this.acceleration.x=a.x,this.acceleration.y=a.y},Celestial.prototype.move=function(){this.x+=this.acceleration.x,this.y+=this.acceleration.y},Celestial.prototype.resolveForces=function(a){var b=new Vector(0,0);a.forEach(function(a){b.x+=a.x,b.y+=a.y}),b.x+=this.acceleration.x,b.y+=this.acceleration.y,this.applyForce(b)};var Universe=function(a,b){this.width=b.width,this.height=b.height,this.objects=[],this.ctx=b.getContext("2d"),this.Gravity=a,this.radiusIndex=1,this.drawing=!1,this.drawingStart={x:0,y:0},this.mousePosition={x:0,y:0};var c=this;b.addEventListener("mousedown",function(a){c.drawingStart={x:a.pageX-b.offsetLeft,y:a.pageY-b.offsetTop},c.drawing=!0}),b.addEventListener("mouseup",function(a){c.drawing=!1;var b=new Celestial(c.mousePosition.x,c.mousePosition.y,2*c.radiusIndex,"#ffffff"),d=b.directionTo(c.drawingStart.x,c.drawingStart.y),e=b.distanceTo(c.drawingStart.x,c.drawingStart.y),f=Math.abs(c.mousePosition.x-c.drawingStart.x)*Math.cbrt(e)/2,g=Math.abs(c.mousePosition.y-c.drawingStart.y)*Math.cbrt(e)/2;b.applyForce({x:d.x*f/150,y:d.y*g/150}),c.addObject(b)}),b.addEventListener("mousemove",function(a){c.mousePosition={x:a.pageX-b.offsetLeft,y:a.pageY-b.offsetTop}}),b.addEventListener("mousewheel",function(a){a.wheelDelta<0?c.radiusIndex>1&&c.radiusIndex--:c.radiusIndex<10&&c.radiusIndex++})};Universe.prototype.drawAll=function(a){var b=this;b.clear(),a||(a=b.objects),a.forEach(function(a){b.draw(a)}),b.drawing&&(b.ctx.strokeStyle="#F5D0A9",b.ctx.lineWidth=1,b.ctx.beginPath(),b.ctx.moveTo(b.drawingStart.x,b.drawingStart.y),b.ctx.lineTo(b.mousePosition.x,b.mousePosition.y),b.ctx.stroke());var c=document.getElementById("massIndex");c&&(c.innerHTML=b.radiusIndex)},Universe.prototype.draw=function(a){this.ctx.fillStyle=a.fill,this.ctx.beginPath(),this.ctx.arc(a.x,a.y,a.radius,0,2*Math.PI),this.ctx.closePath(),this.ctx.fill()},Universe.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},Universe.prototype.addObject=function(a){this.objects.push(a),this.drawAll()},Universe.prototype.start=function(){var a=this;setInterval(function(){a.objects.forEach(function(b,c){var d=[];a.objects.forEach(function(e,f){if(c==f)return!1;var g=b.distanceTo(e.x,e.y),h=a.Gravity.calculateAcceleration(e.mass,g),i=b.directionTo(e.x,e.y);d.push(new Vector(h*i.x,h*i.y))}),b.resolveForces(d)})},200),setInterval(function(){a.objects.forEach(function(a){a.move()}),a.detectCollision(),a.drawAll()},10)},Universe.prototype.detectCollision=function(){for(var a=0;a<this.objects.length-1;a++)for(var b=a+1;b<this.objects.length;b++){var c=this.objects[a].distanceTo(this.objects[b].x,this.objects[b].y);c<=this.objects[b].radius+this.objects[a].radius&&this.mergeObjects(this.objects[a],this.objects[b])}},Universe.prototype.mergeObjects=function(a,b){var c=a.radius>=b.radius?a.x:b.x,d=a.radius>=b.radius?a.y:b.y,e=a.radius>=b.radius?a.acceleration:b.acceleration,f=a.radius>=b.radius?a.radius+b.radius/4:a.radius/4+b.radius,g=new Celestial(c,d,f,"#ffffff",e);this.objects.push(g),this.deleteObject(a),this.deleteObject(b)},Universe.prototype.deleteObject=function(a){this.objects.splice(_.findIndex(this.objects,a),1),delete a};